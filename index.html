<!doctype html>
<html>
  <head>
    <title>Magic The Gathering Cards</title>
  </head>
  <body>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Constants
        const API_URL = "https://api.magicthegathering.io/v1/cards";
        const MAX_CARDS_TO_DISPLAY = 12;

        // Colors
        const COLORS = {
          primary: "#4caf50",
          danger: "#f44336",
          selectedBg: "#e4efe7",
          textSecondary: "#555",
        };

        // Create utility function to create an element with styling
        const createElement = (
          tag,
          classNames = [],
          textContent = "",
          styles = {},
        ) => {
          const element = document.createElement(tag);
          element.textContent = textContent;
          element.classList.add(...classNames);
          Object.assign(element.style, styles);
          return element;
        };

        // Create MagicCardApp class
        class MagicCardApp {
          constructor() {
            this.selectedCards = new Set();
            this.cardElements = [];
            this.init();
          }

          async init() {
            // Set up page
            this.setupPage();

            // Fetch cards
            await this.fetchCards();
          }

          setupPage() {
            // Create main title
            const mainTitle = createElement(
              "h1",
              [],
              "Magic The Gathering Cards",
              { textAlign: "center", marginTop: "20px" },
            );
            document.body.appendChild(mainTitle);

            // Create controls (Select/Deselect All)
            const controls = this.createControls();
            document.body.appendChild(controls);

            // Create grid container for the cards
            this.grid = createElement("div", [], "", {
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
              gap: "20px",
              maxWidth: "1000px",
              margin: "0 auto",
              padding: "20px",
            });
            document.body.appendChild(this.grid);
          }

          createControls() {
            const counter = createElement("div", [], "Selected: 0", {
              fontSize: "20px",
              marginBottom: "10px",
            });
            const selectAllButton = this.createButton(
              "Select All",
              COLORS.primary,
              this.selectAll.bind(this),
            );
            const deselectAllButton = this.createButton(
              "Deselect All",
              COLORS.danger,
              this.deselectAll.bind(this),
            );

            const buttonContainer = createElement(
              "div",
              ["button-container"],
              "",
              { display: "flex", gap: "15px" },
            );
            buttonContainer.appendChild(selectAllButton);
            buttonContainer.appendChild(deselectAllButton);

            const controls = createElement("div", ["controls"], "", {
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              margin: "20px 0",
            });
            controls.appendChild(counter);
            controls.appendChild(buttonContainer);

            return controls;
          }

          createButton(text, color, onClick) {
            const button = createElement("button", [], text, {
              backgroundColor: color,
              padding: "12px 25px",
              border: "none",
              borderRadius: "6px",
              fontSize: "16px",
              cursor: "pointer",
            });
            button.addEventListener("click", onClick);
            button.addEventListener(
              "mouseover",
              () => (button.style.backgroundColor = this.darkenColor(color)),
            );
            button.addEventListener(
              "mouseout",
              () => (button.style.backgroundColor = color),
            );
            return button;
          }

          darkenColor(color) {
            let darken = (parseInt(color.slice(1), 16) - 0x333333).toString(16);
            return `#${darken}`;
          }

          async fetchCards() {
            try {
              const response = await fetch(API_URL);
              const data = await response.json();
              const cards = data.cards.slice(0, MAX_CARDS_TO_DISPLAY);
              this.renderCards(cards);
            } catch (error) {
              console.error("Error fetching cards:", error);
              this.grid.textContent =
                "Failed to load cards. Please try again later.";
            }
          }

          renderCards(cards) {
            cards.forEach((card) => {
              const cardElement = this.createCardElement(card);
              this.grid.appendChild(cardElement.element);
              this.cardElements.push({ id: card.id, ui: cardElement });
            });
          }

          createCardElement(card) {
            const cardDiv = createElement("div", ["card"], "", {
              border: "1px solid #ccc",
              borderRadius: "10px",
              padding: "16px",
              backgroundColor: "white",
              boxShadow: "0 4px 8px rgba(0, 0, 0, 0.1)",
              display: "flex",
              flexDirection: "column",
              justifyContent: "space-between",
              minHeight: "260px",
              transition: "background 0.3s ease",
            });

            const title = createElement("h3", [], card.name);
            const type = createElement("p", [], card.type);
            const text = createElement("p", [], card.text || "No Description", {
              color: COLORS.textSecondary,
            });
            const selectButton = this.createButton(
              "Select",
              COLORS.primary,
              () => this.toggleCardSelection(card, selectButton),
            );

            cardDiv.appendChild(title);
            cardDiv.appendChild(type);
            cardDiv.appendChild(text);
            cardDiv.appendChild(selectButton);

            return {
              element: cardDiv,
              updateSelection: (isSelected) => {
                cardDiv.classList.toggle("selected", isSelected);
                selectButton.textContent = isSelected ? "Deselect" : "Select";
                selectButton.style.backgroundColor = isSelected
                  ? COLORS.danger
                  : COLORS.primary;
              },
            };
          }

          toggleCardSelection(card, button) {
            const isSelected = !this.selectedCards.has(card.id);
            if (isSelected) {
              this.selectedCards.add(card.id);
            } else {
              this.selectedCards.delete(card.id);
            }
            this.updateSelection(card.id, isSelected);
          }

          updateSelection(cardId, isSelected) {
            const card = this.cardElements.find((c) => c.id === cardId);
            card.ui.updateSelection(isSelected);
          }

          selectAll() {
            this.cardElements.forEach((card) => {
              if (!this.selectedCards.has(card.id)) {
                this.selectedCards.add(card.id);
                card.ui.updateSelection(true);
              }
            });
          }

          deselectAll() {
            this.selectedCards.clear();
            this.cardElements.forEach((card) => card.ui.updateSelection(false));
          }
        }

        // Initialize the app
        new MagicCardApp();
      });
    </script>
  </body>
</html>
